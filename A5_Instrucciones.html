<script>
    // Objeto para almacenar el progreso
    const platformProgress = {
        powerbi: 0,
        python: 0,
        r: 0
    };

    function selectDataset(type) {
        // Deseleccionar todas las opciones
        document.querySelectorAll('.dataset-option').forEach(option => {
            option.classList.remove('selected');
        });
        
        // Seleccionar la opciÃ³n clickeada
        event.currentTarget.classList.add('selected');
    }

    function toggleCheckpoint(element) {
        // Prevenir que se active dos veces si se hace clic en el checkbox directamente
        if (event.target.type === 'checkbox') {
            return;
        }
        
        const checkbox = element.querySelector('input[type="checkbox"]');
        checkbox.checked = !checkbox.checked;
        
        // Actualizar estado visual
        if (checkbox.checked) {
            element.classList.add('completed');
        } else {
            element.classList.remove('completed');
        }
        
        updateProgress();
    }

    // FunciÃ³n para manejar cambios directos en checkboxes
    function handleCheckboxChange(checkbox) {
        const element = checkbox.closest('.checkpoint');
        if (checkbox.checked) {
            element.classList.add('completed');
        } else {
            element.classList.remove('completed');
        }
        updateProgress();
    }

    function updateProgress() {
        // Obtener TODOS los checkpoints del documento
        const allCheckpoints = document.querySelectorAll('.checkpoint input[type="checkbox"]');
        const totalCheckpoints = allCheckpoints.length;
        let completedCheckpoints = 0;
        
        // Contar checkpoints completados
        allCheckpoints.forEach(checkbox => {
            if (checkbox.checked) completedCheckpoints++;
        });
        
        // Calcular progreso general
        const overallProgress = totalCheckpoints > 0 ? 
            (completedCheckpoints / totalCheckpoints) * 100 : 0;
        
        // Actualizar UI
        document.getElementById('overallProgress').style.width = overallProgress + '%';
        document.getElementById('progressText').textContent = Math.round(overallProgress) + '% completado';
        
        // Calcular progreso por plataforma
        const powerbiChecks = ['dataset-downloaded', 'pbi-completed', 'pbi-exploration', 
                              'pbi-basic-cleaning', 'pbi-missing-values', 'pbi-outliers', 
                              'pbi-transformations', 'pbi-final'];
        const pythonChecks = ['colab-setup', 'python-data-loaded', 'python-exploration', 
                             'python-cleaning', 'python-completed'];
        const rChecks = ['r-setup', 'r-libraries', 'r-exploration', 
                        'r-cleaning', 'r-mice', 'r-completed'];
        
        platformProgress.powerbi = calculatePlatformProgress(powerbiChecks);
        platformProgress.python = calculatePlatformProgress(pythonChecks);
        platformProgress.r = calculatePlatformProgress(rChecks);
        
        // Actualizar UI de progreso por plataforma
        document.getElementById('powerbiProgress').textContent = `ðŸ“Š Power BI: ${Math.round(platformProgress.powerbi)}%`;
        document.getElementById('pythonProgress').textContent = `ðŸ Python: ${Math.round(platformProgress.python)}%`;
        document.getElementById('rProgress').textContent = `ðŸ“ˆ R: ${Math.round(platformProgress.r)}%`;
        
        // Mostrar mensaje de completaciÃ³n si todo estÃ¡ hecho
        const finalChecks = ['final-powerbi', 'final-python', 'final-r', 
                            'final-files', 'final-comparison', 'final-reflection'];
        const finalCompleted = finalChecks.every(id => {
            const checkbox = document.getElementById(id);
            return checkbox ? checkbox.checked : false;
        });
        
        if (finalCompleted) {
            document.getElementById('completion-message').style.display = 'block';
        }
    }

    function calculatePlatformProgress(checkIds) {
        let completed = 0;
        let total = 0;
        
        checkIds.forEach(id => {
            const checkbox = document.getElementById(id);
            if (checkbox) {
                total++;
                if (checkbox.checked) {
                    completed++;
                }
            }
        });
        
        return total > 0 ? (completed / total) * 100 : 0;
    }

    function selectCode(button) {
        const codeBlock = button.closest('.code-container').querySelector('.code-block');
        
        // Crear un rango de selecciÃ³n
        if (window.getSelection) {
            const selection = window.getSelection();
            const range = document.createRange();
            range.selectNodeContents(codeBlock);
            selection.removeAllRanges();
            selection.addRange(range);
            
            // Feedback visual
            button.textContent = 'âœ… Seleccionado';
            setTimeout(() => {
                button.textContent = 'ðŸ“‹ Seleccionar';
            }, 2000);
        }
    }

    function copyCode(button) {
        const codeBlock = button.closest('.code-container').querySelector('.code-block');
        const codeText = codeBlock.textContent;
        
        // Copiar al portapapeles
        navigator.clipboard.writeText(codeText).then(() => {
            // Feedback visual
            button.textContent = 'âœ… Copiado';
            button.style.background = 'rgba(46, 213, 115, 0.3)';
            
            setTimeout(() => {
                button.textContent = 'ðŸ“„ Copiar';
                button.style.background = 'rgba(255, 255, 255, 0.2)';
            }, 2000);
        }).catch(err => {
            console.error('Error al copiar:', err);
            button.textContent = 'ðŸ“‹ Seleccionado';
            setTimeout(() => {
                button.textContent = 'ðŸ“„ Copiar';
            }, 2000);
        });
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
        // Agregar event listeners a todos los checkboxes
        document.querySelectorAll('.checkpoint input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                handleCheckboxChange(this);
            });
        });
        
        // Calcular progreso inicial
        updateProgress();
    });
</script>
